<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style type="text/css">
        .highlight {
            background-color: yellow;
            color: black;
        }

        .token {
            cursor: default;
        }
    </style>
</head>
<body>
    {{body}}

    <script type="text/javascript">

        let clicked = false;

        const highlightFragment = function (firstTokenIndex, lastTokenIndex) {

            let foundFirst = false;

            for (let i = 0; ; i++) {
                const span = document.querySelectorAll(`.token[data-token-index='${i}']`);

                if (span.length == 0) {
                    if (foundFirst)
                        break;
                    else
                        continue;
                }

                if (i >= firstTokenIndex && i <= lastTokenIndex) {
                    // This token is within the range, so highlight it
                    for (const s of span) {
                        if (!foundFirst)
                            s.scrollIntoView();

                        s.classList.add("highlight");
                    }
                } else {
                    // This token is outside the range, so remove any highlight
                    for (const s of span)
                        s.classList.remove("highlight");
                }

                foundFirst = true;
            }
        }

        document.body.addEventListener("mouseover", event => {
            if (clicked)
                return;

            const tokenIndex = event.target.getAttribute("data-token-index");

            if (tokenIndex)
                chrome.webview.hostObjects.host.HighlightToken(tokenIndex);
            else
                chrome.webview.hostObjects.host.HighlightToken(-1);
        });

        document.body.addEventListener("click", event => {
            const tokenIndex = event.target.getAttribute("data-token-index");

            if (tokenIndex) {
                clicked = true;
                chrome.webview.hostObjects.host.HighlightToken(tokenIndex);
            } else {
                clicked = false;
                highlightFragment(-1, -1);
                chrome.webview.hostObjects.host.HighlightToken(-1);
            }
        });

    </script>
</body>
</html>